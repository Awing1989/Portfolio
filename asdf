A. High Level Sales Analysis
1.  What was the total quantity sold for all products?
SELECT SUM(qty) AS Total_Quantity
FROM balanced_tree.sales;

2.  What is the total generated revenue for all products before discounts?
SELECT SUM(qty*price) AS Total_Revenue
FROM balanced_tree.sales;

3.  What was the total discount amount for all products?
SELECT SUM(qty*price*discount)
FROM balanced_tree.sales
WHERE discount != 0;

B. Transaction Analysis
1.  How many unique transactions were there?
SELECT COUNT(distinct txn_id)
FROM balanced_tree.sales

2.  What is the average unique products purchased in each transaction?
SELECT AVG(Prod_Count) 
FROM 
(SELECT COUNT(distinct prod_id) AS Prod_Count, txn_id 
FROM balanced_tree.sales
GROUP BY txn_id);

3.  What are the 25th, 50th and 75th percentile values for the revenue per transaction?
WITH sub AS (SELECT SUM(qty*price) AS revenue, txn_id
FROM balanced_tree.sales
GROUP BY txn_id)

SELECT
  percentiles[offset(25)] as p25,
  percentiles[offset(50)] as p50,
  percentiles[offset(75)] as p75,
  FROM (
  select approx_quantiles(revenue, 100) percentiles
  from sub);

4.  What is the average discount value per transaction?
WITH sub AS 
(SELECT txn_id, SUM(qty*price*discount*0.01) AS Total_Discount
FROM balanced_tree.sales
GROUP BY txn_id)

SELECT ROUND(AVG(total_discount)) AS avg_discount
FROM sub

5.  What is the percentage split of all transactions for members vs non-members?

6.  What is the average revenue for member transactions and non-member transactions?
